{% extends "layout.html" %}
{% block title %}我的房间{% endblock %}

{% block content %}
<section class="grid-card">
  <h1>我创建的房间</h1>
  <p>房间即使关闭也会保留房间号，可在此处随时重新进入管理。</p>
  <div class="table-scroll">
    <table class="data-table">
      <thead>
        <tr>
          <th>房间名</th>
          <th>房间号</th>
          <th>状态</th>
          <th>创建时间</th>
          <th>操作</th>
        </tr>
      </thead>
      <tbody>
        {% for room in owned_rooms %}
          <tr>
            <td>{{ room.name }}</td>
            <td>{{ room.code }}</td>
            <td>
              <span class="status-badge {{ 'active' if room.is_active else 'closed' }}">
                {{ '开放' if room.is_active else '已关闭' }}
              </span>
            </td>
            <td>{{ room.created_at.strftime('%Y-%m-%d %H:%M') if room.created_at else '' }}</td>
            <td class="actions">
              <a class="primary-btn" href="{{ url_for('main.room_detail', code=room.code) }}">进入</a>
              <form method="post" action="{{ url_for('main.delete_room', code=room.code) }}" onsubmit="return confirm('删除后房间号将失效，确认删除？');">
                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}" />
                <button type="submit" class="danger-btn">删除</button>
              </form>
            </td>
          </tr>
        {% else %}
          <tr><td colspan="5">暂未创建房间</td></tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</section>

<section class="grid-card">
  <h1>我加入的房间</h1>
  <p>快速回到最近参与过的房间，无需再次输入房间号。</p>
  <div class="table-scroll">
    <table class="data-table">
      <thead>
        <tr>
          <th>房间名</th>
          <th>房间号</th>
          <th>加入时间</th>
          <th>状态</th>
          <th>操作</th>
        </tr>
      </thead>
      <tbody>
        {% for membership in memberships %}
          <tr>
            <td>{{ membership.room.name }}</td>
            <td>{{ membership.room.code }}</td>
            <td>{{ membership.joined_at.strftime('%Y-%m-%d %H:%M') }}</td>
            <td>
              <span class="status-badge {{ 'active' if membership.room.is_active else 'closed' }}">
                {{ '开放' if membership.room.is_active else '已关闭' }}
              </span>
            </td>
            <td class="actions">
              {% if membership.room.is_active %}
                <a class="primary-btn" href="{{ url_for('main.room_detail', code=membership.room.code) }}">进入</a>
              {% else %}
                <button class="secondary-btn" disabled>待房主开放</button>
              {% endif %}
              <form method="post" action="{{ url_for('main.leave_room', code=membership.room.code) }}">
                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}" />
                <button type="submit" class="link-btn">退出</button>
              </form>
            </td>
          </tr>
        {% else %}
          <tr><td colspan="5">暂未加入其他房间</td></tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</section>
{% endblock %}

