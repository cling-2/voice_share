{% extends "layout.html" %}
{% block title %}我的音乐{% endblock %}

{% block content %}
<section class="grid-card">
  <h1>上传音乐</h1>
  <p>单个文件 ≤50MB，仅支持 MP3。上传即表示你确认拥有合法使用权限。</p>
  <form method="post" enctype="multipart/form-data">
    {{ upload_form.hidden_tag() }}
    <label>
      <span class="music-title-badge">
        <svg viewBox="0 0 24 24" fill="none">
          <path d="M9 18V5l10-2v13" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          <circle cx="6" cy="18" r="3" stroke="currentColor" stroke-width="2"/>
          <circle cx="17" cy="16" r="3" stroke="currentColor" stroke-width="2"/>
        </svg>
        {{ upload_form.title.label.text }}
      </span>
      {{ upload_form.title(class="input", placeholder="选择文件后自动识别名称，可自行修改") }}
    </label>
    {% for error in upload_form.title.errors %}
      <div class="error">{{ error }}</div>
    {% endfor %}

    <label class="file-input-label">
      <span>选择 MP3 文件</span>
      {{ upload_form.file(class="input", **{'data-autofill-target': upload_form.title.id}) }}
    </label>
    {% for error in upload_form.file.errors %}
      <div class="error">{{ error }}</div>
    {% endfor %}

    <button type="submit" class="primary-btn">上传音乐</button>
  </form>
</section>

<section class="grid-card">
  <h2>我的音乐库</h2>
  <div class="table-scroll">
    <table class="data-table">
      <thead>
        <tr>
          <th>歌曲名</th>
          <th>状态</th>
          <th>上传时间</th>
          <th>操作</th>
        </tr>
      </thead>
      <tbody>
        {% for item in musics %}
          <tr>
            <td>
              <div>{{ item.title }}</div>
              <small class="muted">{{ item.original_filename }}</small>
            </td>
            <td>
              {% if item.status == 'pending' %}待审核{% elif item.status == 'approved' %}已通过{% else %}违规删除{% endif %}
            </td>
            <td>{{ item.uploaded_at.strftime('%Y-%m-%d %H:%M') }}</td>
            <td>
              <form method="post" action="{{ url_for('main.delete_music', music_id=item.id) }}">
                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}" />
                <button type="submit" class="link-btn">删除</button>
              </form>
            </td>
          </tr>
        {% else %}
          <tr><td colspan="4">还没有上传音乐</td></tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</section>
{% endblock %}

