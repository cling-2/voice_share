## 共享听歌房系统

基于 Flask + SQLite 的一体化网页系统，覆盖注册登录、音乐上传、房间共享听歌、房间互动、行为记录、管理员审核等完整流程。普通用户 5 分钟内即可完成 “注册登录 → 创建房间 → 上传音乐 → 播放音乐 → 发送评论” 核心闭环，管理员拥有独立审核后台。

### 功能概览

- **注册登录**：普通用户需通过滑块拼图验证；连续输错密码 2 次会锁定 1 分钟。管理员账号以 `admin_` 为前缀，独立注册与登录，不设频繁限制。
- **个人信息**：用户可修改昵称（≤10 字）与本地头像（≤5MB 图片），即时生效。管理员无个性化入口。
- **音乐上传**：仅允许 MP3（≤50MB），上传前弹出版权提示；音乐先入待审核队列，可删除已上传条目。
- **共享听歌房**：一键创建私密房间，自动生成 6 位房间号；好友输入房间号加入。房间播放逻辑固定为创建者主控。
- **房间互动**：创建者切歌/暂停后全员端同步；房内支持文字评论，实时展示。
- **行为数据**：自动保存最近 30 天的听歌记录（歌曲名 + 播放时间）与房间参与记录（房间号 + 时间），仅本人可见。
- **管理员审核**：后台展示“待审核”与“违规”列表；提供“通过 / 驳回”操作，驳回后自动通知用户并将音乐移至违规列表。

### 运行方式

1. **安装依赖**
   ```bash
   pip install -r requirements.txt
   ```
2. **设置环境变量（可选）**
   - 复制 `.env.example` 为 `.env`，根据需要调整 `SECRET_KEY`、`DATABASE_URL`。
3. **初始化数据库**
   - 首次运行会自动执行 `db.create_all()`，无需额外迁移操作。
4. **启动应用**
   ```bash
   flask --app run.py run
   ```
   或直接执行：
   ```bash
   python run.py
   ```
5. **访问地址**
   - 用户前台：http://localhost:5000
   - 管理员后台：http://localhost:5000/admin （需要先注册管理员账号）

### 目录结构

```
voice share/
├── app/                # Flask 应用主体
│   ├── __init__.py     # 工厂方法、扩展初始化
│   ├── admin.py        # 管理员后台路由
│   ├── auth.py         # 注册、登录、注销
│   ├── forms.py        # WTForms 表单
│   ├── models.py       # SQLAlchemy 数据模型
│   ├── routes.py       # 用户端业务路由
│   └── utils.py        # 工具函数（滑块、文件存储、限流等）
├── templates/          # Jinja2 模板（用户前台 + 管理后台）
├── static/             # 样式、脚本、上传目录
├── config.py           # 配置文件
├── requirements.txt    # 依赖清单
└── run.py              # 启动入口
```

### 关键设计

- **安全性**
  - 使用 Flask-WTF CSRF 防护与密码哈希存储。
  - 滑块验证阻断基础脚本批量注册；登录失败计数在 1 分钟内封锁高频尝试。
  - 上传文件类型、大小双重校验；数据仅本人可见。
- **易用性**
  - 首页仅保留“创建房间 / 我的音乐 / 我的记录”三大入口，操作反馈通过统一弹窗提示。
  - 房间播放同步通过轮询设计，切歌 / 暂停延迟 ≤3 秒。
- **可维护性**
  - 模块化蓝图 + 表单 + 工具函数拆分，便于扩展审核规则、引入 WebSocket 等高级能力。

欢迎按需扩展，例如替换前端框架、接入对象存储、增加 WebSocket 实时推送等。***

